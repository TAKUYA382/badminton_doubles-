<%= turbo_frame_tag dom_id(match) do %>
  <!-- Êú™‰øùÂ≠ò„Éè„Ç§„É©„Ç§„ÉàÂØæË±°ÔºàÁ¥´Êû†Ôºâ -->
  <div class="match-card"
       data-match-id="<%= match.id %>"
       data-match-el>
    <div class="match-card__header">
      <span><%= match.round.index %>ÂõûÊà¶</span>
      <span><%= match.court_number %>„Ç≥„Éº„Éà</span>
      <% if match.respond_to?(:gender_label) %>
        <span><%= match.gender_label %></span>
      <% end %>
      <!-- „ÄåÊú™‰øùÂ≠ò„Äç„Éê„ÉÉ„Ç∏Ôºà„Éê„ÉÉ„Éï„Ç°„Å´Á©ç„Åæ„Çå„Åü„ÇâË°®Á§∫Ôºâ -->
      <span class="badge-unsaved"
            data-unsaved-badge
            style="display:none;">Êú™‰øùÂ≠ò</span>
    </div>

    <div class="match-card__body">
      <table class="table" style="min-width:780px;">
        <thead>
          <tr>
            <th style="width:50%;">„Éö„Ç¢1ÔºàÁ∑®ÈõÜÂèØÔºâ</th>
            <th style="width:50%;">„Éö„Ç¢2ÔºàÁ∑®ÈõÜÂèØÔºâ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <!-- ===== „Éö„Ç¢1 ===== -->
            <td>
              <% ["pair1_member1", "pair1_member2"].each do |slot_key| %>
                <% mem = match.send(slot_key) %>
                <div class="slot-editor drop-target"
                     data-slot-el
                     data-drop-slot="<%= slot_key %>"
                     data-match-id="<%= match.id %>"
                     data-update-url="<%= update_slot_admin_event_path(match.round.event) %>">

                  <div class="info">
                    <div>
                      <strong data-current-name><%= mem&.name || "ÔºàÊú™Ë®≠ÂÆöÔºâ" %></strong>
                      <% if mem %>Ôºà<%= mem.grade_label %>„Éª<%= mem.gender_label %>„Éª<%= mem.skill_label %>Ôºâ<% end %>
                    </div>
                  </div>

                  <!-- Âç≥ÊôÇÂèçÊò†Ôºö„Çπ„É≠„ÉÉ„Éà„ÇíÁ©∫„Å´„Åô„Çã -->
                  <%= form_with url: update_slot_admin_event_path(match.round.event),
                                method: :patch, local: true do %>
                    <%= hidden_field_tag :match_id, match.id %>
                    <%= hidden_field_tag :slot_key, slot_key %>
                    <%= hidden_field_tag :clear, "1" %>
                    <button class="btn btn-outline btn-compact"
                            title="„Çπ„É≠„ÉÉ„Éà„ÇíÁ©∫„Å´„Åô„Çã">√ó</button>
                  <% end %>

                  <!-- Âç≥ÊôÇÂèçÊò† or „Éê„ÉÉ„Éï„Ç°Á©ç„ÅøÂØæÂøú„Çª„É¨„ÇØ„Éà -->
                  <%= form_with url: update_slot_admin_event_path(match.round.event),
                                method: :patch, local: true do %>
                    <%= hidden_field_tag :match_id, match.id %>
                    <%= hidden_field_tag :slot_key, slot_key %>
                    <%= select_tag :member_id,
                          options_from_collection_for_select(
                            @drag_members, :id,
                            ->(mm){ "#{mm.name}Ôºà#{mm.grade_label}„Éª#{mm.gender_label}„Éª#{mm.skill_label}Ôºâ" }
                          ),
                          prompt: "ÈÅ∏Êäû„Åó„Å¶Â∑Æ„ÅóÊõø„Åà",
                          class: "select-compact",
                          data: {
                            member_select: true,  # ‚òÖStimulus„ÅåÊé¢„ÅôÂØæË±°
                            action: "change->lineup#bufferReplaceFromSelect",
                            match_id: match.id,
                            slot_key: slot_key
                          } %>
                    <button class="btn btn-primary btn-compact"
                            title="ÈÅ∏Êäû„ÅßÂç≥ÊôÇÂ∑Æ„ÅóÊõø„Åà">üîÅ</button>
                  <% end %>

                  <!-- „Åæ„Å®„ÇÅ„Å¶Êõ¥Êñ∞Ôºö„Åì„ÅÆ select „ÅÆÂÄ§„Çí„Éê„ÉÉ„Éï„Ç°„Å∏Á©ç„ÇÄ -->
                  <button class="btn btn-outline btn-compact"
                          data-action="click->lineup#bufferReplace"
                          data-match-id="<%= match.id %>"
                          data-slot-key="<%= slot_key %>"
                          data-select-ref="true">
                    ‚è± Â∑Æ„ÅóÊõø„Åà„Çí„Éê„ÉÉ„Éï„Ç°
                  </button>
                </div>
              <% end %>
            </td>

            <!-- ===== „Éö„Ç¢2 ===== -->
            <td>
              <% ["pair2_member1", "pair2_member2"].each do |slot_key| %>
                <% mem = match.send(slot_key) %>
                <div class="slot-editor drop-target"
                     data-slot-el
                     data-drop-slot="<%= slot_key %>"
                     data-match-id="<%= match.id %>"
                     data-update-url="<%= update_slot_admin_event_path(match.round.event) %>">

                  <div class="info">
                    <div>
                      <strong data-current-name><%= mem&.name || "ÔºàÊú™Ë®≠ÂÆöÔºâ" %></strong>
                      <% if mem %>Ôºà<%= mem.grade_label %>„Éª<%= mem.gender_label %>„Éª<%= mem.skill_label %>Ôºâ<% end %>
                    </div>
                  </div>

                  <!-- Âç≥ÊôÇÂèçÊò†Ôºö„Çπ„É≠„ÉÉ„Éà„ÇíÁ©∫„Å´„Åô„Çã -->
                  <%= form_with url: update_slot_admin_event_path(match.round.event),
                                method: :patch, local: true do %>
                    <%= hidden_field_tag :match_id, match.id %>
                    <%= hidden_field_tag :slot_key, slot_key %>
                    <%= hidden_field_tag :clear, "1" %>
                    <button class="btn btn-outline btn-compact"
                            title="„Çπ„É≠„ÉÉ„Éà„ÇíÁ©∫„Å´„Åô„Çã">√ó</button>
                  <% end %>

                  <!-- Âç≥ÊôÇÂèçÊò† or „Éê„ÉÉ„Éï„Ç°Á©ç„ÅøÂØæÂøú„Çª„É¨„ÇØ„Éà -->
                  <%= form_with url: update_slot_admin_event_path(match.round.event),
                                method: :patch, local: true do %>
                    <%= hidden_field_tag :match_id, match.id %>
                    <%= hidden_field_tag :slot_key, slot_key %>
                    <%= select_tag :member_id,
                          options_from_collection_for_select(
                            @drag_members, :id,
                            ->(mm){ "#{mm.name}Ôºà#{mm.grade_label}„Éª#{mm.gender_label}„Éª#{mm.skill_label}Ôºâ" }
                          ),
                          prompt: "ÈÅ∏Êäû„Åó„Å¶Â∑Æ„ÅóÊõø„Åà",
                          class: "select-compact",
                          data: {
                            member_select: true,  # ‚òÖ„Åì„Åì„ÇÇÂøÖË¶Å
                            action: "change->lineup#bufferReplaceFromSelect",
                            match_id: match.id,
                            slot_key: slot_key
                          } %>
                    <button class="btn btn-primary btn-compact"
                            title="ÈÅ∏Êäû„ÅßÂç≥ÊôÇÂ∑Æ„ÅóÊõø„Åà">üîÅ</button>
                  <% end %>

                  <!-- „Åæ„Å®„ÇÅ„Å¶Êõ¥Êñ∞Ôºö„Åì„ÅÆ select „ÅÆÂÄ§„Çí„Éê„ÉÉ„Éï„Ç°„Å∏Á©ç„ÇÄ -->
                  <button class="btn btn-outline btn-compact"
                          data-action="click->lineup#bufferReplace"
                          data-match-id="<%= match.id %>"
                          data-slot-key="<%= slot_key %>"
                          data-select-ref="true">
                    ‚è± Â∑Æ„ÅóÊõø„Åà„Çí„Éê„ÉÉ„Éï„Ç°
                  </button>
                </div>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
<% end %>