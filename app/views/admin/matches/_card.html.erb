<%# app/views/admin/matches/_card.html.erb %>
<%# å¿…è¦ãƒ­ãƒ¼ã‚«ãƒ«: match, drag_members %>

<%= turbo_frame_tag dom_id(match) do %>
  <div class="match-card" data-match-id="<%= match.id %>">
    <div class="match-card__header">
      <span><%= match.round.index %>å›æˆ¦</span>
      <span><%= match.court_number %>ã‚³ãƒ¼ãƒˆ</span>
      <%# æ€§åˆ¥è¡¨ç¤ºï¼ˆã‚ã‚Œã°ï¼‰ %>
      <span><%= match.gender_label if match.respond_to?(:gender_label) %></span>
    </div>

    <div class="match-card__body">
      <%# ========== å…±é€šï¼š1ã‚¹ãƒ­ãƒƒãƒˆã®ç·¨é›†ãƒ–ãƒ­ãƒƒã‚¯ ========== %>
      <% slot_block = lambda do |slot_key| %>
        <% mem = match.send(slot_key) %>

        <div class="slot-editor drop-target"
             data-drop-slot="<%= slot_key %>"
             data-match-id="<%= match.id %>"
             data-update-url="<%= update_slot_admin_event_path(match.round.event) %>">
          <div class="info" style="margin-bottom:6px;">
            <div>
              <strong><%= mem&.name || "ï¼ˆæœªè¨­å®šï¼‰" %></strong>
              <% if mem %>
                ï¼ˆ<%= mem.grade_label %>ãƒ»<%= mem.gender_label %>ãƒ»<%= mem.skill_label %>ï¼‰
              <% end %>
            </div>
          </div>

          <div style="display:flex; gap:6px; align-items:center; flex-wrap:wrap;">
            <%# ã‚¯ãƒªã‚¢ %>
            <%= form_with url: update_slot_admin_event_path(match.round.event), method: :patch, local: true do %>
              <%= hidden_field_tag :match_id, match.id %>
              <%= hidden_field_tag :slot_key, slot_key %>
              <%= hidden_field_tag :clear, "1" %>
              <button class="btn btn-outline btn-compact" title="ã“ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’ç©ºã«ã™ã‚‹">Ã—</button>
            <% end %>

            <%# å·®ã—æ›¿ãˆã‚»ãƒ¬ã‚¯ãƒˆï¼ˆâ˜…é‡è¦ï¼šå€™è£œã¯ drag_members ã‚’ä½¿ã†ï¼‰ %>
            <%= form_with url: update_slot_admin_event_path(match.round.event), method: :patch, local: true, style: "display:flex; gap:6px; align-items:center;" do %>
              <%= hidden_field_tag :match_id, match.id %>
              <%= hidden_field_tag :slot_key, slot_key %>

              <%= select_tag :member_id,
                    options_from_collection_for_select(
                      drag_members,
                      :id,
                      ->(mm) { "#{mm.name}ï¼ˆ#{mm.grade_label}ãƒ»#{mm.gender_label}ãƒ»#{mm.skill_label}ï¼‰" },
                      mem&.id # æ—¢å­˜ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã‚Œã°åˆæœŸé¸æŠ
                    ),
                    include_blank: "é¸æŠã—ã¦å·®ã—æ›¿ãˆ",
                    class: "select-compact",
                    title: "å€™è£œã‹ã‚‰é¸ã‚“ã§å·®ã—æ›¿ãˆ" %>

              <button class="btn btn-primary btn-compact">ğŸ” å·®ã—æ›¿ãˆ</button>
            <% end %>

            <%# ï¼ˆä»»æ„ï¼‰ã¾ã¨ã‚ã¦æ›´æ–°ãƒãƒƒãƒ•ã‚¡ã«å…¥ã‚Œã‚‹ãƒœã‚¿ãƒ³ã‚’ç½®ãå ´åˆ
                data-* ã¯ Stimulus(lineup) ã§æ‹¾ã†æƒ³å®šã€‚ç„¡ã‘ã‚Œã°å‰Šé™¤å¯ã€‚ %>
            <button class="btn btn-outline btn-compact"
                    data-action="click->lineup#queueReplace"
                    data-lineup-match-id-value="<%= match.id %>"
                    data-lineup-slot-key-value="<%= slot_key %>"
                    data-lineup-current-member-id-value="<%= mem&.id %>">
              â± å·®ã—æ›¿ãˆã‚’ãƒãƒƒãƒ•ã‚¡
            </button>
          </div>
        </div>
      <% end %>

      <%# ========== ãƒšã‚¢1 ========== %>
      <div class="pair">
        <div class="pair-title">ãƒšã‚¢1ï¼ˆç·¨é›†å¯ï¼‰</div>
        <%= slot_block.call("pair1_member1") %>
        <%= slot_block.call("pair1_member2") %>
      </div>

      <%# ========== ãƒšã‚¢2 ========== %>
      <div class="pair">
        <div class="pair-title">ãƒšã‚¢2ï¼ˆç·¨é›†å¯ï¼‰</div>
        <%= slot_block.call("pair2_member1") %>
        <%= slot_block.call("pair2_member2") %>
      </div>
    </div>
  </div>
<% end %>